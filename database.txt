CREATE TYPE user_role AS ENUM ('USER', 'ADMIN');

CREATE TYPE transaction_type AS ENUM ('DEPOSIT', 'WITHDRAW', 'PAYMENT');

CREATE TYPE transaction_status AS ENUM ('PENDING', 'SUCCESS', 'FAILED');

CREATE TYPE order_status AS ENUM ('PENDING', 'COMPLETED', 'CANCELLED');

CREATE TYPE vps_status AS ENUM ('RUNNING', 'STOPPED', 'EXPIRED', 'PENDING');

CREATE TABLE USERS (

    id SERIAL PRIMARY KEY,

    avatar TEXT,

    first_name VARCHAR(50),

    last_name VARCHAR(50),

    full_name VARCHAR(100),

    email VARCHAR(255) UNIQUE NOT NULL,

    password TEXT NOT NULL,

    role user_role DEFAULT 'USER',

    is_active BOOLEAN DEFAULT TRUE,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);



CREATE TABLE USER_SESSIONS (

    id SERIAL PRIMARY KEY,

    user_id INTEGER REFERENCES USERS(id) ON DELETE CASCADE,

    refresh_token TEXT NOT NULL,

    expired_at TIMESTAMP NOT NULL,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);

CREATE TABLE WALLETS (

    id SERIAL PRIMARY KEY,

    user_id INTEGER UNIQUE REFERENCES USERS(id) ON DELETE CASCADE,

    balance DECIMAL(15, 2) DEFAULT 0.00,

    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);



CREATE TABLE TRANSACTIONS (

    id SERIAL PRIMARY KEY,

    wallet_id INTEGER REFERENCES WALLETS(id) ON DELETE CASCADE,

    type transaction_type NOT NULL,

    amount DECIMAL(15, 2) NOT NULL,

    status transaction_status DEFAULT 'PENDING',

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);

CREATE TABLE ORDERS (

    id SERIAL PRIMARY KEY,

    user_id INTEGER REFERENCES USERS(id),

    total_price DECIMAL(15, 2) NOT NULL,

    status order_status DEFAULT 'PENDING',

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);



CREATE TABLE VPS (

    id SERIAL PRIMARY KEY,

    order_id INTEGER REFERENCES ORDERS(id),

    user_id INTEGER REFERENCES USERS(id),

    cpu INTEGER NOT NULL,

    ram INTEGER NOT NULL, -- Đơn vị MB hoặc GB

    storage INTEGER NOT NULL, -- Đơn vị GB

    os VARCHAR(50),

    ip_address VARCHAR(45),

    status vps_status DEFAULT 'PENDING',

    expired_at TIMESTAMP,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);



CREATE TABLE VPS_CREDENTIALS (

    id SERIAL PRIMARY KEY,

    vps_id INTEGER UNIQUE REFERENCES VPS(id) ON DELETE CASCADE,

    username VARCHAR(50) NOT NULL,

    password TEXT NOT NULL,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);

CREATE TABLE VPS_ACTION_LOGS (

    id SERIAL PRIMARY KEY,

    vps_id INTEGER REFERENCES VPS(id) ON DELETE CASCADE,

    action VARCHAR(100) NOT NULL,

    performed_by INTEGER REFERENCES USERS(id),

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);



CREATE TABLE AUDIT_LOGS (

    id SERIAL PRIMARY KEY,

    user_id INTEGER REFERENCES USERS(id),

    action VARCHAR(255) NOT NULL,

    detail TEXT,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP

);
